<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Design Plan of R Package forestly • forestly</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Design Plan of R Package forestly">
<meta property="og:description" content="forestly">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">forestly</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/design_plan.html">Design Plan of R Package forestly</a>
    </li>
    <li>
      <a href="../articles/dmc_report.html">Interactive Safety Reports for DMC</a>
    </li>
    <li>
      <a href="../articles/example.html">Interactive Forest Plot for DMC</a>
    </li>
    <li>
      <a href="../articles/onboarding.html">onboarding</a>
    </li>
    <li>
      <a href="../articles/rate_compare.html">Unstratified and Stratified  Miettinen and Nurminen Test</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="design_plan_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Design Plan of R Package forestly</h1>
            
      
      
      <div class="hidden name"><code>design_plan.Rmd</code></div>

    </div>

    
    
<blockquote>
<p>This document is for developers who would like to understand the internal of the <code>forestly</code> package.</p>
</blockquote>
<div id="overview" class="section level1">
<h1 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h1>
<p>The <code>forestly</code> package is developed to generate interactive forest plot for the safety analysis in clinical trials. To generate an interactive forest plot, we develop three main functions as listed below. And the details of these three main functions will be introduced in the next three sections separately.</p>
<ul>
<li>
<code>tidy_ae_table</code>: This function is used to obtain adverse event (AE) information ready for visualization.</li>
<li>
<code>download_ae_reports</code>: This function is used to generate a download bottom, so users can download the AE summary tables by clicking this bottom.</li>
<li>
<code>forestly</code>: This function is used to generate an interactive forest plot.</li>
</ul>
<p>A minimal example summarized the major steps in using <code>forestly</code> package is</p>
<pre><code>mydata &lt;- tidy_ae_table(...)    # Step 1: create tidy AE data
download_ae_reports(mydata)     # Step 2: generate download botton
forestly(mydata)                # Step 3: generate interactive forest plot 
                                # (the order of Step 2 and Step 3 can be reversed)</code></pre>
</div>
<div id="main-function-1-tidy_ae_table" class="section level1">
<h1 class="hasAnchor">
<a href="#main-function-1-tidy_ae_table" class="anchor"></a>Main function 1: <code>tidy_ae_table()</code>
</h1>
<p>The main function <code><a href="../reference/tidy_ae_table.html">tidy_ae_table()</a></code> is used to obtain AE information ready for visualization. Specifically speaking, it merges standardized <code>adsl</code> and <code>adae</code> tables together, and outputs a AE summary table. The AE summary table summarizes the number/ratio of subjects experiencing a certain AE for both treatment arm and control arm.</p>
<p>There are some utility functions developed inside of <code><a href="../reference/tidy_ae_table.html">tidy_ae_table()</a></code> and we list them as follows.</p>
<ul>
<li><p><code><a href="../reference/tidy_population.html">tidy_population()</a></code>: This function is used to prepare the observation datasets for the use in function <code><a href="../reference/tidy_ae_table.html">tidy_ae_table()</a></code>. The function filter the <code>adsl</code> dataset, and define the proper treatment order in the dataset.</p></li>
<li><p><code><a href="../reference/tidy_observation.html">tidy_observation()</a></code>: This function is used to prepare the observation datasets for the use in function <code><a href="../reference/tidy_ae_table.html">tidy_ae_table()</a></code>. The function filter the <code>adae</code> dataset, and define the proper treatment order in the dataset.</p></li>
<li><p>`<code><a href="../reference/prop_test_mn.html">prop_test_mn()</a></code>: This function tests equal proportion using Miettinen and Nurminen method. In the <code>forestly</code> package, it generates the confidence interval (CI) for the risk difference between treatment arm and control arm.</p></li>
<li><p><code>define_ae_selectList()</code>: This function is to specify the AE labels to be displayed in the select list of the interactive forestly plot. It has two arguments, (1) <code>ae_criterion</code> and (2) <code>ae_label</code>. The first argument <code>ae_criterion</code> is a (vector of) string, which defines the criterion to select a class of AE to display in the interactive forest plot. For example, if <code>ae_criterion = 'AESER == "Y"'</code>, then it will select the serious AE. The second argument <code>ae_label</code> is a (vector of) string, which defines the labels to be displayed in the select list of interactive forest plot. If these two arguments are both string vectors, then they must be a 1:1 map. This function is used in the arguments <code>ae_interested =</code> in function <code><a href="../reference/tidy_ae_table.html">tidy_ae_table()</a></code> (see examples below). It throws errors if the length of the <code>ae_criterion</code> doesn’t match that of <code>ae_label</code>.</p></li>
</ul>
<pre><code># Example 1: if you would like to display the serious AE
tidy_ae_table(...,
              ae_interested = define_ae_selectList(ae_criterion = 'AESER == "Y"', 
                                                   ae_label = "serious AE"),
              ...).

# Example 2: if you would like to display both serious AE and drug-related AE
tidy_ae_table(...,
              ae_interested = define_ae_selectList(ae_criterion = c('AESER != "N"', 'AEREL != "None"'),
                                                   ae_label = c("serious AE", "drug-related AE")
              ...).</code></pre>
<ul>
<li><p><code><a href="../reference/tidy_multi_ae_label.html">tidy_multi_ae_label()</a></code>: This a function is design to <code>rbind</code> data together according to the interested AE labels defined in <code>ae_interested =</code>. For example, if you use Example 1 above, <code><a href="../reference/tidy_multi_ae_label.html">tidy_multi_ae_label()</a></code> will generate an AE summary table as rbind(summary table of all AE, summary of serious AE).</p></li>
<li><p><code><a href="../reference/tidy_ae_listing.html">tidy_ae_listing()</a></code>: This function generates a data frame which serves as the listed details in the the reactable.</p></li>
</ul>
</div>
<div id="main-function-2-tlf_download" class="section level1">
<h1 class="hasAnchor">
<a href="#main-function-2-tlf_download" class="anchor"></a>Main function 2: <code>tlf_download()</code>
</h1>
<p>This function generates a download bottom for users to download AE tables.</p>
<ul>
<li>
<code>tlf_ae_summary</code>: a function to create AE summary table.
<ul>
<li>Example: <a href="https://merck.github.io/r2rtf/articles/example-ae-summary.html" class="uri">https://merck.github.io/r2rtf/articles/example-ae-summary.html</a>
</li>
</ul>
</li>
<li>
<code>tlf_ae_specific</code>: a function to create specific AE table.</li>
<li>
<code>tlf_ae_listing</code>: a function to create AE listing.</li>
</ul>
<p>The output of the <code>tlf_xxx</code> functions are <code>r2rtf</code> objects created by <code>rtf_encode</code></p>
<ul>
<li>
<code>tlf_download</code>: a function to download multiple TLFs in Rmarkdown. Rewrite <code>ae_download_report</code> to allow it use <code>tlf_xxx</code> functions as input.</li>
</ul>
<pre><code><a href="../reference/tlf_ae_summary.html">tlf_ae_summary()   # generate the AE summary table
tlf_ae_specific()  # generate the specific AE table
# tlf[[4]] &lt;- tlf_ae_listing()   # As needed ????

tlf_download()    # download the above tables</a></code></pre>
</div>
<div id="main-function-3-forestly" class="section level1">
<h1 class="hasAnchor">
<a href="#main-function-3-forestly" class="anchor"></a>Main function 3: <code>forestly()</code>
</h1>
<p>This function generates an interactive forest plot for the returned objected of <code><a href="../reference/tidy_ae_table.html">tidy_ae_table()</a></code>. For this interactive forstly plot, it consists two blocks.</p>
<p>The first block is a select list. The items listed in the select list is specified by the <code>ae_label =</code> in function <code>tidy_ae_table(..., ae_interested = , ...)</code>. By clicking different AE labels, different reactable will be generated. For example, if you click “serious AE”, then the reactable will only display the serious AE summary table. The main tool to develop this block is <code><a href="https://rdrr.io/pkg/crosstalk/man/filter_select.html">crosstalk::filter_select()</a></code>.</p>
<p>The second block is a reactable. The reactable summarizes the AE information under the selected AE label. The main tool to develop this block is <code><a href="https://glin.github.io/reactable/reference/reactable.html">reactable::reactable()</a></code>.</p>
<p>There are some utility functions used to develop <code><a href="../reference/forestly.html">forestly()</a></code> and we listed them as follows.</p>
<ul>
<li>
<p><code><a href="../reference/forestly_design_details.html">forestly_design_details()</a></code>: This function returns the design details of the reactable in the forest plot, including</p>
<ul>
<li>the design details of the cell of the two proportions;</li>
<li>the design details of the cell of the CI;</li>
<li>the design details of the footer of the two proportions;</li>
<li>the design details of the footer of the CI.</li>
</ul>
<p>These design details are returned by another utility function <code><a href="../reference/sparkline_point_js.html">sparkline_point_js()</a></code>, and we will introduce its details later.</p>
<p>To generate the above design details, users need to specify the elements for the design, including</p>
<ul>
<li>color: the color for the two proportion/CI plot (see arguments <code>fig_prop_color =</code> and <code>fig_diff_color =</code>);</li>
<li>label: the labels to be displayed under the two proportion/CI plot (see arguments <code>fig_prop_label =</code> and <code>fig_diff_label =</code>);</li>
<li>column width: the column width of the two proportion/CI plot (see arguments <code>fig_prop_colwidth =</code> and <code>fig_diff_colwidth =</code>);</li>
<li>range: the x-axis range to plot the two proportion/CI plot (see arguments <code>fig_prop_range =</code> and <code>fig_diff_range =</code>).</li>
</ul>
</li>
<li><p><code><a href="../reference/sparkline_point_js.html">sparkline_point_js()</a></code>: This function generates a Javascript to be rendered. It is used for the design details of reactables, including both the cell and the footer. It has dependence to the files under path <code>forestly/inst/javascripts/sparkline.js</code>.</p></li>
<li><p><code><a href="../reference/mk_reactable.html">mk_reactable()</a></code>: This function is used to create a data table from tabular data with sorting and pagination by default. Essentially, it is a wrapper of function <code><a href="https://glin.github.io/reactable/reference/reactable.html">reactable()</a></code> for robust BAAMR usage. It has dependence to R package <code>reactable</code>.</p></li>
</ul>
</div>
<div id="other-utility-filesfunctions" class="section level1">
<h1 class="hasAnchor">
<a href="#other-utility-filesfunctions" class="anchor"></a>Other Utility Files/Functions</h1>
<ul>
<li>
<code>important_functions.R</code>: This is used to declare the R-package dependency of the functions we used to develop the above functions.</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Yilong Zhang. Site built with pkgdown 1.6.1.
  </p>
  <p>Copyright © Merck Sharp &amp; Dohme Corp., a subsidiary of Merck &amp; Co., Inc., Kenilworth, NJ, USA.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
